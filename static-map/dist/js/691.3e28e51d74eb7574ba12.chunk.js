(self.webpackChunkstatic_map=self.webpackChunkstatic_map||[]).push([[691],{2272:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var o=i(67294),s=i.n(o),r=i(8606),n=i.n(r),a=i(27418),p=i.n(a),h=i(45697),c=i.n(h),l=i(14293),m=i.n(l),d=i(68105);function u(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class y extends s().Component{constructor(...e){super(...e),u(this,"updateZIndex",(e=>{const t=e||this.props.position,i=this.props.map.imageryLayers._layers.reduce(((e,t,i)=>this.provider===t?i:e),-1);let o=this.props.map.imageryLayers._layers.reduce(((e,i,o)=>-1===e&&t<i._position?o:e),-1);-1===o&&(o=i);const s=o-i;0!==s&&Array.apply(null,{length:Math.abs(s)}).map(Number.call,Number).forEach((()=>{this.props.map.imageryLayers[s>0?"raise":"lower"](this.provider)}))})),u(this,"setLayerVisibility",(e=>{const t=this.getVisibilityOption(this.props),i=this.getVisibilityOption(e);i!==t&&(i?(this.addLayer(e),this.updateZIndex()):this.removeLayer())})),u(this,"getVisibilityOption",(e=>{const{options:t={},zoom:i,resolutions:o=(0,d.getResolutions)()}=e,{visibility:s,minResolution:r=-1/0,maxResolution:n=1/0,disableResolutionLimits:a}=t||{};if(!a&&!m()(o[i])){const e=o[i];if(!(e<n&&e>=r))return!1}return!1!==s})),u(this,"setLayerOpacity",(e=>{e!==(this.props.options&&void 0!==this.props.options.opacity?this.props.options.opacity:1)&&this.layer&&this.provider&&(this.provider.alpha=e)})),u(this,"createLayer",((e,t,i,o,s)=>{if(e){const r=p()({},t,i?{zIndex:i}:null,{securityToken:s});this.layer=n().createLayer(e,r,o),this.layer&&(this.layer.layerName=t.name,this.layer.layerId=t.id),null===this.layer&&this.props.onCreationError(t)}})),u(this,"updateLayer",((e,t)=>{const i=n().updateLayer(e.type,this.layer,{...e.options,securityToken:e.securityToken},{...t.options,securityToken:t.securityToken},this.props.map);i&&(this.removeLayer(),this.layer=i,this.addLayer(e))})),u(this,"addLayerInternal",(e=>{e.options.useForElevation?this.props.map.terrainProvider=this.layer:(this.provider=this.props.map.imageryLayers.addImageryProvider(this.layer),this.provider._position=this.props.position,void 0!==e.options.opacity&&(this.provider.alpha=e.options.opacity))})),u(this,"addLayer",(e=>{if(this.layer&&!this.layer.detached&&(this.addLayerInternal(e),this.props.options.refresh&&this.layer.updateParams)){let t=0;this.refreshTimer=setInterval((()=>{const i=this.layer.updateParams(p()({},this.props.options.params,{_refreshCounter:t++}));this.removeLayer(),this.layer=i,this.addLayerInternal(e)}),this.props.options.refresh)}})),u(this,"removeLayer",(e=>{var t;const i=e||this.provider;i&&this.props.map.imageryLayers.remove(i),this.layer.detached&&null!==(t=this.layer)&&void 0!==t&&t.remove&&this.layer.remove()}))}componentDidMount(){this.createLayer(this.props.type,this.props.options,this.props.position,this.props.map,this.props.securityToken),this.props.options&&this.layer&&this.getVisibilityOption(this.props)&&(this.addLayer(this.props),this.updateZIndex())}UNSAFE_componentWillReceiveProps(e){this.setLayerVisibility(e);const t=e.options&&void 0!==e.options.opacity?e.options.opacity:1;if(this.setLayerOpacity(t),e.position!==this.props.position&&(this.updateZIndex(e.position),this.provider&&(this.provider._position=e.position)),this.props.options&&this.props.options.params&&this.layer.updateParams&&e.options.visibility&&Object.keys(this.props.options.params).reduce(((t,i)=>e.options.params[i]!==this.props.options.params[i]||t),!1)){const t=this.provider,i=this.layer.updateParams(e.options.params);this.layer=i,this.addLayer(e),setTimeout((()=>{this.removeLayer(t)}),1e3)}this.updateLayer(e,this.props)}componentWillUnmount(){this.layer&&this.props.map&&!this.props.map.isDestroyed()&&(this.layer.detached?this.layer.remove():(this.layer.destroy&&this.layer.destroy(),this.props.map.imageryLayers.remove(this.provider)),this.refreshTimer&&clearInterval(this.refreshTimer))}render(){if(this.props.children){const e=this.layer,t=e?s().Children.map(this.props.children,(t=>t?s().cloneElement(t,{container:e,styleName:this.props.options&&this.props.options.styleName}):null)):null;return s().createElement(s().Fragment,null,t)}return n().renderLayer(this.props.type,this.props.options,this.props.map,this.props.map.id,this.layer)}}u(y,"propTypes",{map:c().object,type:c().string,options:c().object,onCreationError:c().func,position:c().number,securityToken:c().string,zoom:c().number});const g=y},18187:(e,t,i)=>{"use strict";i.d(t,{Z:()=>C});var o=i(66410),s=i.n(o),r=i(45697),n=i.n(r),a=i(89255),p=i(67294),h=i.n(p),c=i(73935),l=i.n(c),m=i(54980),d=i(68922),u=i.n(d),y=i(68105),g=i(10312),v=i(27418),b=i.n(v),E=i(23493),P=i.n(E);function f(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class T extends h().Component{constructor(...e){super(...e),f(this,"state",{}),f(this,"onClick",((e,t)=>{if(this.props.onClick&&null!==t.position){const i=e.camera.pickEllipsoid(t.position,e.scene.globe.ellipsoid);let o=u().getMouseXYZ(e,t)||i&&s().Cartographic.fromCartesian(i);if(o){const e=180*o.latitude/Math.PI,t=180*o.longitude/Math.PI,i=(90-e)/180*this.props.standardHeight*(this.props.zoom+1),s=(180+t)/360*this.props.standardWidth*(this.props.zoom+1);this.props.onClick({pixel:{x:s,y:i},height:this.props.mapOptions&&this.props.mapOptions.terrainProvider?o.height:void 0,cartographic:o,latlng:{lat:e,lng:t},crs:"EPSG:4326"})}}})),f(this,"onMouseMove",(e=>{if(this.props.onMouseMove&&e.endPosition){const t=this.map.camera.pickEllipsoid(e.endPosition,this.map.scene.globe.ellipsoid);let i=u().getMouseXYZ(this.map,e)||t&&s().Cartographic.fromCartesian(t);if(i){const e=Math.round(i.height);this.props.onMouseMove({y:180*i.latitude/Math.PI,x:180*i.longitude/Math.PI,z:e,crs:"EPSG:4326"})}}})),f(this,"getDocument",(()=>this.props.document||document)),f(this,"getMapOptions",(e=>{let t={};if(e.terrainProvider){let{type:i,...o}=e.terrainProvider;switch(i){case"cesium":t.terrainProvider=new(s().CesiumTerrainProvider)(o);break;case"ellipsoid":t.terrainProvider=new(s().EllipsoidTerrainProvider)}}return b()({},e,t)})),f(this,"getCenter",(()=>{const e=this.map.camera.positionCartographic;return{longitude:180*e.longitude/Math.PI,latitude:180*e.latitude/Math.PI,height:e.height}})),f(this,"getZoomFromHeight",(e=>Math.log2(this.props.zoomToHeight/e)+1)),f(this,"getHeightFromZoom",(e=>this.props.zoomToHeight/Math.pow(2,e-1))),f(this,"gestureStartListener",(e=>{e.preventDefault()})),f(this,"setMousePointer",(e=>{this.map&&(l().findDOMNode(this).getElementsByClassName("cesium-viewer")[0].style.cursor=e||"auto")})),f(this,"_updateMapPositionFromNewProps",(e=>{const t=this.getCenter(),i=this.getZoomFromHeight(t.height),o=function(e,t){return void 0!==e&&void 0!==t&&e.toFixed(12)-t.toFixed(12)<=1e-12},r=!o(e.center.x,t.longitude)||!o(e.center.y,t.latitude),n=e.zoom!==i;if(r||n){const t={destination:s().Cartesian3.fromDegrees(e.center.x,e.center.y,this.getHeightFromZoom(e.zoom)),orientation:e.viewerOptions.orientation};this.setView(t)}})),f(this,"setView",(e=>{this.props.mapOptions&&this.props.mapOptions.flyTo?this.map.camera.flyTo(e,this.props.mapOptions.defaultFlightOptions):this.map.camera.setView(e)})),f(this,"subscribeClickEvent",(e=>{const t={LEFT_UP:s().ScreenSpaceEventType.LEFT_UP,LEFT_DOWN:s().ScreenSpaceEventType.LEFT_DOWN,LEFT_CLICK:s().ScreenSpaceEventType.LEFT_CLICK,PINCH_START:s().ScreenSpaceEventType.PINCH_START,PINCH_END:s().ScreenSpaceEventType.PINCH_END,PINCH_MOVE:s().ScreenSpaceEventType.PINCH_MOVE},i=new a.Subject,o=new a.Subject;Object.keys(t).forEach((e=>this.hand.setInputAction((s=>{o.next({type:t[e],movement:s}),i.next({type:t[e],movement:s})}),t[e]))),o.filter((e=>e.type===t.PINCH_END)).switchMap((()=>a.Observable.of(!0).concat(a.Observable.of(!1).delay(500)))).startWith(!1).switchMap((e=>e?a.Observable.never():i)).filter((e=>e.type===t.LEFT_DOWN)).switchMap((({movement:e})=>i.filter((e=>e.type===t.LEFT_CLICK)).takeUntil(a.Observable.timer(500).merge(i.filter((i=>{return i.type!==t.LEFT_UP&&i.type!==t.LEFT_CLICK||i.type===t.LEFT_UP&&(o=e&&e.position,s=i.movement&&i.movement.position,!(o&&s&&o.x===s.x&&o.y===s.y));var o,s})))))).subscribe((({movement:t})=>this.onClick(e,t))),this.clickStream$=i,this.pauserStream$=o})),f(this,"registerHooks",(()=>{this.props.hookRegister.registerHook(y.GET_PIXEL_FROM_COORDINATES_HOOK),this.props.hookRegister.registerHook(y.GET_COORDINATES_FROM_PIXEL_HOOK),this.props.hookRegister.registerHook(y.ZOOM_TO_EXTENT_HOOK,((e,{crs:t,duration:i}={})=>{const o=(0,g.reprojectBbox)(e,t,"EPSG:4326");if(this.map.camera.flyTo){const e=s().Rectangle.fromDegrees(o[0],o[1],o[2],o[3]);this.map.camera.flyTo({destination:e,duration:i,complete:this.updateMapInfoState})}}))})),f(this,"updateMapInfoState",(()=>{const e=this.getCenter(),t=this.getZoomFromHeight(e.height),i={height:Math.round(this.props.standardWidth*(t+1)),width:Math.round(this.props.standardHeight*(t+1))};this.props.onMapViewChanges({x:e.longitude,y:e.latitude,crs:"EPSG:4326"},t,{bounds:{minx:-180,miny:-90,maxx:180,maxy:90},crs:"EPSG:4326",rotation:0},i,this.props.id,this.props.projection,{orientation:{heading:this.map.camera.heading,pitch:this.map.camera.pitch,roll:this.map.camera.roll}},(0,y.getResolutions)()[t])}))}UNSAFE_componentWillMount(){this.getDocument().addEventListener("gesturestart",this.gestureStartListener)}componentDidMount(){var e,t;const i=document.querySelector((null===(e=this.props.mapOptions)||void 0===e||null===(t=e.attribution)||void 0===t?void 0:t.container)||"#footer-attribution-container");let o=new(s().Viewer)(this.getDocument().getElementById(this.props.id),b()({baseLayerPicker:!1,animation:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,timeline:!1,navigationHelpButton:!1,navigationInstructionsInitiallyVisible:!1,creditContainer:i||void 0},this.getMapOptions(this.props.mapOptions)));this.props.registerHooks&&this.registerHooks(),o.scene.globe.baseColor=s().Color.WHITE,o.imageryLayers.removeAll(),o.camera.moveEnd.addEventListener(this.updateMapInfoState),this.hand=new(s().ScreenSpaceEventHandler)(o.scene.canvas),this.subscribeClickEvent(o),this.hand.setInputAction(P()(this.onMouseMove.bind(this),500),s().ScreenSpaceEventType.MOUSE_MOVE),o.camera.setView({destination:s().Cartesian3.fromDegrees(this.props.center.x,this.props.center.y,this.getHeightFromZoom(this.props.zoom))}),this.setMousePointer(this.props.mousePointer),this.map=o,this.forceUpdate(),this.props.mapOptions.navigationTools&&(this.cesiumNavigation=window.CesiumNavigation,this.cesiumNavigation&&this.cesiumNavigation.navigationInitialization(this.props.id,o))}UNSAFE_componentWillReceiveProps(e){return e.mousePointer!==this.props.mousePointer&&this.setMousePointer(e.mousePointer),e.mapStateSource!==this.props.id&&this._updateMapPositionFromNewProps(e),!1}componentWillUnmount(){this.clickStream$.complete(),this.pauserStream$.complete(),this.hand.destroy(),this.getDocument().removeEventListener("gesturestart",this.gestureStartListener),this.map.destroy()}render(){const e=this.map,t=this.props.projection,i=e?h().Children.map(this.props.children,(i=>i?h().cloneElement(i,{map:e,projection:t,onCreationError:this.props.onCreationError,zoom:this.props.zoom}):null)):null;return h().createElement("div",{id:this.props.id},i)}}f(T,"propTypes",{id:n().string,document:n().object,center:m.ZP.PropTypes.center,zoom:n().number.isRequired,mapStateSource:m.ZP.PropTypes.mapStateSource,projection:n().string,onMapViewChanges:n().func,onCreationError:n().func,onClick:n().func,onMouseMove:n().func,mapOptions:n().object,standardWidth:n().number,standardHeight:n().number,mousePointer:n().string,zoomToHeight:n().number,registerHooks:n().bool,hookRegister:n().object,viewerOptions:n().object}),f(T,"defaultProps",{id:"map",onMapViewChanges:()=>{},onClick:()=>{},onCreationError:()=>{},projection:"EPSG:3857",mapOptions:{},standardWidth:512,standardHeight:512,zoomToHeight:8e7,registerHooks:!0,hookRegister:{registerHook:y.registerHook},viewerOptions:{orientation:{heading:0,pitch:-1*Math.PI/2,roll:0}}});const C=T},68922:(e,t,i)=>{var o=i(66410);e.exports={getMouseXYZ:(e,t)=>{var i=e.scene;const s=t.position||t.endPosition;if(!s)return null;const r=e.camera.getPickRay(s),n=e.scene.globe.pick(r,e.scene),a=i._globe.ellipsoid;if(o.defined(n)){const o=a.cartesianToCartographic(n),s=function(e,t){if(null!==t.position){const i=e.scene,o=i._globe.ellipsoid;return i._camera.pickEllipsoid(t.position||t.endPosition,o)}return null}(e,t);return s&&(o.height=i._globe.getHeight(o),o.cartesian=s,o.position=n),o}return null},getMouseTile:(e,t)=>{const i=e.scene;if(!t.position)return null;const o=e.camera.getPickRay(t.position);return e.scene.globe.pickTile(o,i)}}}}]);